name: Zeabur 自动化控制 (v1.4.1)

on:
  schedule:
    - cron: '*/20 * * * *'
  workflow_dispatch:
    inputs:
      action:
        description: '执行动作'
        required: true
        default: 'suspend'
        type: choice
        options:
          - suspend
          - resume

jobs:
  zeabur-task:
    runs-on: ubuntu-latest
    steps:
      - name: 执行 Zeabur 指令
        run: |
          ACTION="${{ github.event.inputs.action }}"
          if [ -z "$ACTION" ]; then
            ACTION="suspend"
          fi
          
          echo "正在执行 $ACTION 操作..."
          
          # 使用官方要求的 serviceID 和 environmentID 参数
          # 注意：这里的转义字符非常重要
          QUERY="mutation { ${ACTION}Service(serviceID: \"${{ secrets.SERVICE_ID }}\", environmentID: \"${{ secrets.ENVIRONMENT_ID }}\") }"
          
          RESPONSE=$(curl --request POST \
            --url https://api.zeabur.com/graphql \
            --header 'Authorization: Bearer ${{ secrets.ZEABUR_TOKEN }}' \
            --header 'Content-Type: application/json' \
            --data "{\"query\":\"$QUERY\"}")
          
          echo "API 响应内容: $RESPONSE"
          
          if [[ $RESPONSE == *"errors"* ]]; then
            echo "❌ 执行失败：请检查 Service ID 和 Environment ID 是否匹配"
            exit 1
          else
            echo "✅ 执行成功"
          fi
